{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the MediVue NeoNurse application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "username": {
          "type": "string",
          "description": "The username of the user. This should be unique."
        },
        "role": {
          "type": "string",
          "description": "Role of the user (e.g., 'admin', 'nurse').",
          "format": "string"
        }
      },
      "required": [
        "id",
        "username",
        "role"
      ]
    },
    "Bed": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Bed",
      "type": "object",
      "description": "Represents a bed in the hospital.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the bed entity."
        },
        "bedNumber": {
          "type": "string",
          "description": "The bed number or identifier within the hospital."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Bed)"
        }
      },
      "required": [
        "id",
        "bedNumber",
        "userId"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user information, including role (e.g., admin, nurse). Used for authentication and authorization. Includes the `userId` parameter for secure access control.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/beds/{bedId}",
        "definition": {
          "entityName": "Bed",
          "schema": {
            "$ref": "#/backend/entities/Bed"
          },
          "description": "Stores bed information, including bed number and a denormalized 'userId' for authorization independence. Enables users to manage the beds that they own and have access to.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user (owner)."
            },
            {
              "name": "bedId",
              "description": "The unique identifier for the bed."
            }
          ]
        }
      }
    ],
    "reasoning": "This Firestore data structure is designed to support the MediVue NeoNurse application, focusing on real-time patient monitoring and bed management. It prioritizes authorization independence and clear security rules by adhering to the principles outlined in the prompt. The structure separates user and bed data to streamline access control and querying. Specifically:\n\n1.  **Authorization Independence:**  Since beds are linked to users, the `beds` collection denormalizes the `userId` field. This allows security rules to validate that a user has access to a bed's data without performing expensive `get()` operations.\n2.  **Clarity of Intent:** The structure explicitly separates user and bed data, making the purpose of each collection clear. The naming conventions (e.g., `userId`) are semantic and predictable.\n3.  **DBAC (Database-Based Access Control):** User roles are stored in the `/users/{userId}` document, allowing for role-based authorization within security rules without relying on custom claims.\n4.  **QAPs (Rules are not Filters):** Segregation is used to ensure only authorized users can `list` bed data. The path-based ownership (`/users/{userId}/beds/{bedId}`) allows efficient filtering for beds owned by a specific user.\n5.  **Invariants:** The structure supports invariants such as ownership (enforced by security rules) and potentially timestamps (although timestamps were not present in the original schema).\n\nThe use of path-based ownership (`/users/{userId}/beds/{bedId}`) is a deliberate choice to facilitate secure and efficient `list` operations.  This structure allows for easy querying of all beds associated with a specific user while ensuring that only authorized users can access this data."
  }
}